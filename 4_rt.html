<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This book provides a comprehensive introduction to cognitive modeling using Bayesian mixed models in Julia.">

<title>4&nbsp; Reaction Times – Cognitive Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./5_individual.html" rel="next">
<link href="./3_scales.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Cognitive Models: Computational Modeling of Cognitive Processes with Bayesian Mixed Models in Julia</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DominiqueMakowski/CognitiveModels"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="./Cognitive-Models.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./4_rt.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reaction Times</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./media/cover.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Fundamentals of Bayesian Modeling in Julia</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_scales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Choice and Scales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_rt.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reaction Times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_individual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Individual Parameters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-data" id="toc-the-data" class="nav-link active" data-scroll-target="#the-data"><span class="header-section-number">4.1</span> The Data</a></li>
  <li><a href="#descriptive-models" id="toc-descriptive-models" class="nav-link" data-scroll-target="#descriptive-models"><span class="header-section-number">4.2</span> Descriptive Models</a>
  <ul class="collapse">
  <li><a href="#gaussian-aka-linear-model" id="toc-gaussian-aka-linear-model" class="nav-link" data-scroll-target="#gaussian-aka-linear-model"><span class="header-section-number">4.2.1</span> Gaussian (aka <em>Linear</em>) Model</a></li>
  <li><a href="#scaled-gaussian-model" id="toc-scaled-gaussian-model" class="nav-link" data-scroll-target="#scaled-gaussian-model"><span class="header-section-number">4.2.2</span> Scaled Gaussian Model</a></li>
  <li><a href="#the-problem-with-linear-models" id="toc-the-problem-with-linear-models" class="nav-link" data-scroll-target="#the-problem-with-linear-models"><span class="header-section-number">4.2.3</span> The Problem with Linear Models</a></li>
  <li><a href="#shifted-lognormal-model" id="toc-shifted-lognormal-model" class="nav-link" data-scroll-target="#shifted-lognormal-model"><span class="header-section-number">4.2.4</span> Shifted LogNormal Model</a></li>
  <li><a href="#exgaussian-model" id="toc-exgaussian-model" class="nav-link" data-scroll-target="#exgaussian-model"><span class="header-section-number">4.2.5</span> ExGaussian Model</a></li>
  <li><a href="#wald-model" id="toc-wald-model" class="nav-link" data-scroll-target="#wald-model"><span class="header-section-number">4.2.6</span> Wald Model</a></li>
  </ul></li>
  <li><a href="#generative-models-ddm" id="toc-generative-models-ddm" class="nav-link" data-scroll-target="#generative-models-ddm"><span class="header-section-number">4.3</span> Generative Models (DDM)</a></li>
  <li><a href="#other-models-lba-lnr" id="toc-other-models-lba-lnr" class="nav-link" data-scroll-target="#other-models-lba-lnr"><span class="header-section-number">4.4</span> Other Models (LBA, LNR)</a></li>
  <li><a href="#including-random-effects" id="toc-including-random-effects" class="nav-link" data-scroll-target="#including-random-effects"><span class="header-section-number">4.5</span> Including Random Effects</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">4.6</span> Additional Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reaction Times</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="https://img.shields.io/badge/status-WIP-orange.png" class="img-fluid"></p>
<section id="the-data" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-data"><span class="header-section-number">4.1</span> The Data</h2>
<p>For this chapter, we will be using the data from <span class="citation" data-cites="wagenmakers2008diffusion">Wagenmakers et al. (<a href="references.html#ref-wagenmakers2008diffusion" role="doc-biblioref">2008</a>)</span> - Experiment 1 <span class="citation" data-cites="heathcote2012linear">(also reanalyzed by <a href="references.html#ref-heathcote2012linear" role="doc-biblioref">Heathcote and Love 2012</a>)</span>, that contains responses and response times for several participants in two conditions (where instructions emphasized either <strong>speed</strong> or <strong>accuracy</strong>). Using the same procedure as the authors, we excluded all trials with uninterpretable response time, i.e., responses that are too fast (&lt;180 ms) or too slow <span class="citation" data-cites="theriault2024check">(&gt;2 sec instead of &gt;3 sec, see <a href="references.html#ref-theriault2024check" role="doc-biblioref">Thériault et al. 2024</a> for a discussion on outlier removal)</span>.</p>
<pre class="{julia}"><code>#| code-fold: false

using Downloads, CSV, DataFrames
using Turing, Distributions, SequentialSamplingModels
using GLMakie

df = CSV.read(Downloads.download("https://raw.githubusercontent.com/DominiqueMakowski/CognitiveModels/main/data/wagenmakers2008.csv"), DataFrame)

# Show 10 first rows
first(df, 10)</code></pre>
<p>In the previous chapter, we modelled the error rate (the probability of making an error) using a logistic model, and observed that it was higher in the <code>"Speed"</code> condition. But how about speed? We are going to first take interest in the RT of <strong>Correct</strong> answers only (as we can assume that errors are underpinned by a different <em>generative process</em>).</p>
<p>After filtering out the errors, we create a new column, <code>Accuracy</code>, which is the “binarization” of the <code>Condition</code> column, and is equal to 1 when the condition is <code>"Accuracy"</code> and 0 when it is <code>"Speed"</code>.</p>
<pre class="{julia}"><code>#| output: false

df = df[df.Error .== 0, :]
df.Accuracy = df.Condition .== "Accuracy"</code></pre>
<div class="callout callout-style-default callout-tip callout-titled" title="Code Tip">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note the usage of <em>vectorization</em> <code>.==</code> as we want to compare each element of the <code>Condition</code> vector to the target <code>"Accuracy"</code>.</p>
</div>
</div>
<pre class="{julia}"><code>function plot_distribution(df, title="Empirical Distribution of Data from Wagenmakers et al. (2018)")
    fig = Figure()
    ax = Axis(fig[1, 1], title=title,
        xlabel="RT (s)",
        ylabel="Distribution",
        yticksvisible=false,
        xticksvisible=false,
        yticklabelsvisible=false)
    Makie.density!(df[df.Condition .== "Speed", :RT], color=("#EF5350", 0.7), label = "Speed")
    Makie.density!(df[df.Condition .== "Accuracy", :RT], color=("#66BB6A", 0.7), label = "Accuracy")
    Makie.axislegend("Condition"; position=:rt)
    Makie.ylims!(ax, (0, nothing))
    return fig
end

plot_distribution(df, "Empirical Distribution of Data from Wagenmakers et al. (2018)")</code></pre>
</section>
<section id="descriptive-models" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="descriptive-models"><span class="header-section-number">4.2</span> Descriptive Models</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note until the last section, we will disregard the existence of multiple participants (which require the inclusion of random effects in the model). We will treat the data as if it was a single participant at first to better understand the parameters, but will show how to add random effects at the end.</p>
</div>
</div>
<section id="gaussian-aka-linear-model" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="gaussian-aka-linear-model"><span class="header-section-number">4.2.1</span> Gaussian (aka <em>Linear</em>) Model</h3>
<p>A linear model is the most common type of model. It aims at predicting the <strong>mean</strong> <span class="math inline">\(\mu\)</span> of the outcome variable using a <strong>Normal</strong> (aka <em>Gaussian</em>) distribution for the residuals. In other words, it models the outcome <span class="math inline">\(y\)</span> as a Normal distribution with a mean <span class="math inline">\(\mu\)</span> that is itself hte result of a linear function of the predictors <span class="math inline">\(X\)</span> and a variance <span class="math inline">\(\sigma\)</span> that is constant across all values of the predictors. It can be written as <span class="math inline">\(y = Normal(\mu, \sigma)\)</span>, where <span class="math inline">\(\mu = intercept + slope * X\)</span>.</p>
<p>In order to fit a Linear Model for RTs, we need to set a prior on all these parameters, namely: - The variance <span class="math inline">\(\sigma\)</span> (correspondong to the “spread” of RTs) - The mean <span class="math inline">\(\mu\)</span> for the intercept (i.e., at the reference condition which is in our case <code>"Speed"</code>) - The effect of the condition (the slope).</p>
<section id="model-specification" class="level4">
<h4 class="anchored" data-anchor-id="model-specification">Model Specification</h4>
<pre class="{julia}"><code>#| code-fold: false
#| output: false

@model function model_Gaussian(rt; condition=nothing)

    # Set priors on variance, intercept and effect of condition
    σ ~ truncated(Normal(0, 0.5); lower=0)

    μ_intercept ~ truncated(Normal(0, 1); lower=0)
    μ_condition ~ Normal(0, 0.3)

    for i in 1:length(rt)
        μ = μ_intercept + μ_condition * condition[i]
        rt[i] ~ Normal(μ, σ)
    end
end


model = model_Gaussian(df.RT; condition=df.Accuracy)
chain_Gaussian = sample(model, NUTS(), 400)</code></pre>
<pre class="{julia}"><code>#| code-fold: false

# Summary (95% CI)
hpd(chain_Gaussian; alpha=0.05)</code></pre>
<p>The effect of Condition is significant, people are on average slower (higher RT) when condition is <code>"Accuracy"</code>. But is our model good?</p>
</section>
<section id="posterior-predictive-check" class="level4">
<h4 class="anchored" data-anchor-id="posterior-predictive-check">Posterior Predictive Check</h4>
<pre class="{julia}"><code>#| output: false

pred = predict(model_Gaussian([(missing) for i in 1:length(df.RT)], condition=df.Accuracy), chain_Gaussian)
pred = Array(pred)</code></pre>
<pre class="{julia}"><code>#| fig-width: 10
#| fig-height: 7

fig = plot_distribution(df, "Predictions made by Gaussian (aka Linear) Model")
for i in 1:length(chain_Gaussian)
    lines!(Makie.KernelDensity.kde(pred[:, i]), color=ifelse(df.Accuracy[i] == 1, "#388E3C", "#D32F2F"), alpha=0.1)
end
fig</code></pre>
</section>
</section>
<section id="scaled-gaussian-model" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="scaled-gaussian-model"><span class="header-section-number">4.2.2</span> Scaled Gaussian Model</h3>
<p>The previous model, despite its poor fit to the data, suggests that the mean RT is higher for the <code>Accuracy</code> condition. But it seems like the distribution is also <em>wider</em> (response time is more variable). Typical linear model estimate only one value for sigma <span class="math inline">\(\sigma\)</span> for the whole model, hence the requirement for <strong>homoscedasticity</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Homoscedasticity</strong>, or homogeneity of variances, is the assumption of similar variances accross different values of predictors. It is important in linear models as only one value for sigma <span class="math inline">\(\sigma\)</span> is estimated.</p>
</div>
</div>
<p>Is it possible to set sigma <span class="math inline">\(\sigma\)</span> as a parameter that would depend on the condition, in the same way as mu <span class="math inline">\(\mu\)</span>? In Julia, this is very simple.</p>
<p>All we need is to set sigma <span class="math inline">\(\sigma\)</span> as the result of a linear function, such as <span class="math inline">\(\sigma = intercept + slope * condition\)</span>. This means setting a prior on the intercept of sigma <span class="math inline">\(\sigma\)</span> (in our case, the variance in the reference condition) and a prior on how much this variance changes for the other condition. This change can, by definition, be positive or negative (i.e., the other condition can have either a biggger or a smaller variance), so the prior over the effect of condition should ideally allow for positive and negative values (e.g., <code>σ_condition ~ Normal(0, 0.1)</code>).</p>
<p>But this leads to an <strong>important problem</strong>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The combination of an intercept and a (possible negative) slope for sigma <span class="math inline">\(\sigma\)</span> technically allows for negative variance values, which is impossible (distributions cannot have a negative variance). This issue is one of the most important to address when setting up complex models for RTs.</p>
</div>
</div>
<p>Indeed, even if we set a very narrow prior on the intercept of sigma <span class="math inline">\(\sigma\)</span> to fix it at for instance <strong>0.14</strong>, and a narrow prior on the effect of condition, say <span class="math inline">\(Normal(0, 0.001)\)</span>, an effect of condition of <strong>-0.15</strong> is still possible (albeit with very low probability). And such effect would lead to a sigma <span class="math inline">\(\sigma\)</span> of <strong>0.14 - 0.15 = -0.01</strong>, which would lead to an error (and this will often happen as the sampling process does explore unlikely regions of the parameter space).</p>
<section id="solution-1-directional-effect-of-condition" class="level4">
<h4 class="anchored" data-anchor-id="solution-1-directional-effect-of-condition">Solution 1: Directional Effect of Condition</h4>
<p>One possible (but not recommended) solution is to simply make it impossible for the effect of condition to be negative by <em>Truncating</em> the prior to a lower bound of 0. This can work in our case, because we know that the comparison condition is likely to have a higher variance than the reference condition (the intercept) - and if it wasn’t the case, we could have changed the reference factor. However, this is not a good practice as we are enforcing a very strong a priori specific direction of the effect, which is not always justified.</p>
<pre class="{julia}"><code>#| code-fold: false
#| output: false

@model function model_ScaledlGaussian1(rt; condition=nothing)

    # Priors
    μ_intercept ~ truncated(Normal(0, 1); lower=0)
    μ_condition ~ Normal(0, 0.3)

    σ_intercept ~ truncated(Normal(0, 0.5); lower=0)  # Same prior as previously
    σ_condition ~ truncated(Normal(0, 0.1); lower=0)  # Enforce positivity

    for i in 1:length(rt)
        μ = μ_intercept + μ_condition * condition[i]
        σ = σ_intercept + σ_condition * condition[i]
        rt[i] ~ Normal(μ, σ)
    end
end

model = model_ScaledlGaussian1(df.RT; condition=df.Accuracy)
chain_ScaledGaussian = sample(model, NUTS(), 400)</code></pre>
<pre class="{julia}"><code>#| code-fold: false

# Summary (95% CI)
hpd(chain_ScaledGaussian; alpha=0.05)</code></pre>
<p>We can see that the effect of condition on sigma <span class="math inline">\(\sigma\)</span> is significantly positive: the variance is higher in the <code>Accuracy</code> condition as compared to the <code>Speed</code> condition.</p>
</section>
<section id="solution-2-avoid-exploring-negative-variance-values" class="level4">
<h4 class="anchored" data-anchor-id="solution-2-avoid-exploring-negative-variance-values">Solution 2: Avoid Exploring Negative Variance Values</h4>
<p>The other trick is to force the sampling algorithm to avoid exploring negative variance values (when sigma <span class="math inline">\(\sigma\)</span> &lt; 0). This can be done by adding a conditional statement when sigma <span class="math inline">\(\sigma\)</span> is negative to avoid trying this value and erroring, and instead returning an infinitely low model probability (<code>-Inf</code>) to push away the exploration of this impossible region.</p>
<pre class="{julia}"><code>#| code-fold: false
#| output: false

@model function model_ScaledlGaussian(rt; condition=nothing)

    # Priors
    μ_intercept ~ truncated(Normal(0, 1); lower=0)
    μ_condition ~ Normal(0, 0.3)

    σ_intercept ~ truncated(Normal(0, 0.5); lower=0)
    σ_condition ~ Normal(0, 0.1)

    for i in 1:length(rt)
        μ = μ_intercept + μ_condition * condition[i]
        σ = σ_intercept + σ_condition * condition[i]
        if σ &lt; 0  # Avoid negative variance values
            Turing.@addlogprob! -Inf
            return nothing
        end
        rt[i] ~ Normal(μ, σ)
    end
end

model = model_ScaledlGaussian(df.RT; condition=df.Accuracy)
chain_ScaledGaussian = sample(model, NUTS(), 400)</code></pre>
<pre class="{julia}"><code>#| code-fold: false

hpd(chain_ScaledGaussian; alpha=0.05)</code></pre>
<pre class="{julia}"><code>pred = predict(model_ScaledlGaussian([(missing) for i in 1:length(df.RT)], condition=df.Accuracy), chain_ScaledGaussian)
pred = Array(pred)

fig = plot_distribution(df, "Predictions made by Scaled Gaussian Model")
for i in 1:length(chain_ScaledGaussian)
    lines!(Makie.KernelDensity.kde(pred[:, i]), color=ifelse(df.Accuracy[i] == 1, "#388E3C", "#D32F2F"), alpha=0.1)
end
fig</code></pre>
<!-- #### Solution 3: Express Variance on the Exponential Scale
See https://github.com/itsdfish/SequentialSamplingModels.jl/issues/78#issuecomment-2211702253 
IS THAT RIGHT? -->
<p>Although relaxing the homoscedasticity assumption is a good step forward, allowing us to make <strong>richer conclusions</strong> and better capturing the data. Despite that, the Gaussian model stil seem to be a poor fit to the data.</p>
</section>
</section>
<section id="the-problem-with-linear-models" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="the-problem-with-linear-models"><span class="header-section-number">4.2.3</span> The Problem with Linear Models</h3>
<p>Reaction time (RTs) have been traditionally modeled using traditional linear models and their derived statistical tests such as <em>t</em>-test and ANOVAs. Importantly, linear models - by definition - will try to predict the <em>mean</em> of the outcome variable by estimating the “best fitting” <em>Normal</em> distribution. In the context of reaction times (RTs), this is not ideal, as RTs typically exhibit a non-normal distribution, skewed towards the left with a long tail towards the right. This means that the parameters of a Normal distribution (mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>) are not good descriptors of the data.</p>
<p><img src="media/rt_normal.gif" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Linear models try to find the best fitting Normal distribution for the data. However, for reaction times, even the best fitting Normal distribution (in red) does not capture well the actual data (in grey).</p>
</blockquote>
<p>A popular mitigation method to account for the non-normality of RTs is to transform the data, using for instance the popular <em>log-transform</em>. However, this practice should be avoided as it leads to various issues, including loss of power and distorted results interpretation <span class="citation" data-cites="lo2015transform schramm2019reaction">(<a href="references.html#ref-lo2015transform" role="doc-biblioref">Lo and Andrews 2015</a>; <a href="references.html#ref-schramm2019reaction" role="doc-biblioref">Schramm and Rouder 2019</a>)</span>. Instead, rather than applying arbitrary data transformation, it would be better to swap the Normal distribution used by the model for a more appropriate one that can better capture the characteristics of a RT distribution.</p>
</section>
<section id="shifted-lognormal-model" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="shifted-lognormal-model"><span class="header-section-number">4.2.4</span> Shifted LogNormal Model</h3>
<p>One of the obvious candidate alternative to the log-transformation would be to use a model with a Log-transformed Normal distribution. A LogNormal distribution is a distribution of a random variable whose logarithm is normally distributed. A <strong>Shifted</strong> LogNormal model introduces a shift (a delay) parameter <em>tau</em> <span class="math inline">\(\tau\)</span> that corresponds to the minimum “starting time” of the response process.</p>
<p>We need to set a prior for this parameter, which is usually truncated between 0 (to exclude negative minimum times) and the minimum RT of the data (the logic being that the minimum delay for response must be lower than the faster response actually observed).</p>
<p>While <span class="math inline">\(Uniform(0, min(RT))\)</span> is a common choice of prior, it is not ideal as it implies that all values between 0 and the minimum RT are equally likely, which is not the case. Indeed, psychology research has shown that such minimum response time for Humans is often betwen 100 and 250 ms. Moreover, in our case, we explicitly removed all RTs below 180 ms, suggesting that the minimum response time is more likely to approach 180 ms than 0 ms.</p>
<section id="prior-on-minimum-rt" class="level4">
<h4 class="anchored" data-anchor-id="prior-on-minimum-rt">Prior on Minimum RT</h4>
<p>Instead of a <span class="math inline">\(Uniform\)</span> prior, we will use a <span class="math inline">\(Gamma(1.1, 11)\)</span> distribution (truncated at min. RT), as this particular parameterization reflects the low probability of very low minimum RTs (near 0) and a steadily increasing probability for increasing times.</p>
<pre class="{julia}"><code>xaxis = range(0, 0.3, 1000)
fig = lines(xaxis, pdf.(Gamma(1.1, 11), xaxis); color=:blue, label="Gamma(1.1, 11)")
vlines!([minimum(df.RT)]; color="red", linestyle=:dash, label="Min. RT = 0.18 s")
axislegend()
fig</code></pre>
</section>
<section id="model-specification-1" class="level4">
<h4 class="anchored" data-anchor-id="model-specification-1">Model Specification</h4>
<pre class="{julia}"><code>#| code-fold: false
#| output: false

@model function model_LogNormal(rt; min_rt=minimum(df.RT), condition=nothing)

    # Priors 
    τ ~ truncated(Gamma(1.1, 11); upper=min_rt)

    μ_intercept ~ Normal(0, exp(1))  # On the log-scale: exp(μ) to get value in seconds
    μ_condition ~ Normal(0, exp(0.3))

    σ_intercept ~ truncated(Normal(0, 0.5); lower=0)
    σ_condition ~ Normal(0, 0.1)

    for i in 1:length(rt)
        μ = μ_intercept + μ_condition * condition[i]
        σ = σ_intercept + σ_condition * condition[i]
        if σ &lt; 0  # Avoid negative variance values
            Turing.@addlogprob! -Inf
            return nothing
        end
        rt[i] ~ ShiftedLogNormal(μ, σ, τ)
    end
end

model = model_LogNormal(df.RT; condition=df.Accuracy)
chain_LogNormal = sample(model, NUTS(), 400)</code></pre>
</section>
<section id="interpretation" class="level4">
<h4 class="anchored" data-anchor-id="interpretation">Interpretation</h4>
<pre class="{julia}"><code>#| code-fold: false

hpd(chain_LogNormal; alpha=0.05)</code></pre>
<pre class="{julia}"><code>pred = predict(model_LogNormal([(missing) for i in 1:length(df.RT)]; condition=df.Accuracy), chain_LogNormal)
pred = Array(pred)

fig = plot_distribution(df, "Predictions made by Shifted LogNormal Model")
for i in 1:length(chain_LogNormal)
    lines!(Makie.KernelDensity.kde(pred[:, i]), color=ifelse(df.Accuracy[i] == 1, "#388E3C", "#D32F2F"), alpha=0.1)
end
fig</code></pre>
<p>This model provides a much better fit to the data, and confirms that the <code>Accuracy</code> condition is associated with higher RTs and higher variability (i.e., a larger distribution width).</p>
</section>
</section>
<section id="exgaussian-model" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="exgaussian-model"><span class="header-section-number">4.2.5</span> ExGaussian Model</h3>
<p>Another popular model to describe RTs uses the <strong>ExGaussian</strong> distribution, i.e., the <em>Exponentially-modified Gaussian</em> distribution <span class="citation" data-cites="balota2011moving matzke2009psychological">(<a href="references.html#ref-balota2011moving" role="doc-biblioref">Balota and Yap 2011</a>; <a href="references.html#ref-matzke2009psychological" role="doc-biblioref">Matzke and Wagenmakers 2009</a>)</span>.</p>
<p>This distribution is a convolution of normal and exponential distributions and has three parameters, namely <em>mu</em> <span class="math inline">\(\mu\)</span> and <em>sigma</em> <span class="math inline">\(\sigma\)</span> - the mean and standard deviation of the Gaussian distribution - and <em>tau</em> <span class="math inline">\(\tau\)</span> - the exponential component of the distribution (note that although denoted by the same letter, it does not correspond directly to a shift of the distribution). Intuitively, these parameters reflect the centrality, the width and the tail dominance, respectively.</p>
<p><img src="media/rt_exgaussian.gif" class="img-fluid"></p>
<p>Beyond the descriptive value of these types of models, some have tried to interpret their parameters in terms of <strong>cognitive mechanisms</strong>, arguing for instance that changes in the Gaussian components (<span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>) reflect changes in attentional processes [e.g., “the time required for organization and execution of the motor response”; <span class="citation" data-cites="hohle1965inferred">Hohle (<a href="references.html#ref-hohle1965inferred" role="doc-biblioref">1965</a>)</span>], whereas changes in the exponential component (<span class="math inline">\(\tau\)</span>) reflect changes in intentional (i.e., decision-related) processes <span class="citation" data-cites="kieffaber2006switch">(<a href="references.html#ref-kieffaber2006switch" role="doc-biblioref">Kieffaber et al. 2006</a>)</span>. However, <span class="citation" data-cites="matzke2009psychological">Matzke and Wagenmakers (<a href="references.html#ref-matzke2009psychological" role="doc-biblioref">2009</a>)</span> demonstrate that there is likely no direct correspondence between ex-Gaussian parameters and cognitive mechanisms, and underline their value primarily as <strong>descriptive tools</strong>, rather than models of cognition <em>per se</em>.</p>
<p>Descriptively, the three parameters can be interpreted as:</p>
<ul>
<li><strong>Mu</strong> <span class="math inline">\(\mu\)</span>: The location / centrality of the RTs. Would correspond to the mean in a symmetrical distribution.</li>
<li><strong>Sigma</strong> <span class="math inline">\(\sigma\)</span>: The variability and dispersion of the RTs. Akin to the standard deviation in normal distributions.</li>
<li><strong>Tau</strong> <span class="math inline">\(\tau\)</span>: Tail weight / skewness of the distribution.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that these parameters are not independent with respect to distribution characteristics, such as the empirical mean and SD. Below is an example of different distributions with the same location (<em>mu</em> <span class="math inline">\(\mu\)</span>) and dispersion (<em>sigma</em> <span class="math inline">\(\sigma\)</span>) parameters. Although only the tail weight parameter (<em>tau</em> <span class="math inline">\(\tau\)</span>) is changed, the whole distribution appears to shift is centre of mass. Hence, one should be careful note to interpret the values of <em>mu</em> <span class="math inline">\(\mu\)</span> directly as the “mean” or the distribution peak and <em>sigma</em> <span class="math inline">\(\sigma\)</span> as the SD or the “width”.</p>
</div>
</div>
<p><img src="media/rt_exgaussian2.gif" class="img-fluid"></p>
<section id="model-specification-2" class="level4">
<h4 class="anchored" data-anchor-id="model-specification-2">Model Specification</h4>
<p>TODO.</p>
</section>
</section>
<section id="wald-model" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="wald-model"><span class="header-section-number">4.2.6</span> Wald Model</h3>
<p>Moe from statistical models that <em>describe</em> to models that <em>generate</em> RT-like data.</p>
</section>
</section>
<section id="generative-models-ddm" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="generative-models-ddm"><span class="header-section-number">4.3</span> Generative Models (DDM)</h2>
<p>Use DDM as a case study to introduce generative models</p>
<ul>
<li><a href="https://dominiquemakowski.github.io/easyRT/articles/ddm.html"><strong>Drift Diffusion Model (DDM) in R: A Tutorial</strong></a></li>
</ul>
</section>
<section id="other-models-lba-lnr" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="other-models-lba-lnr"><span class="header-section-number">4.4</span> Other Models (LBA, LNR)</h2>
</section>
<section id="including-random-effects" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="including-random-effects"><span class="header-section-number">4.5</span> Including Random Effects</h2>
<p>TODO.</p>
</section>
<section id="additional-resources" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="additional-resources"><span class="header-section-number">4.6</span> Additional Resources</h2>
<ul>
<li><a href="https://lindeloev.github.io/shiny-rt/"><strong>Lindelov’s overview of RT models</strong></a>: An absolute must-read.</li>
<li><a href="https://www.frontiersin.org/articles/10.3389/fpsyg.2019.00102/full"><strong>De Boeck &amp; Jeon (2019)</strong></a>: A paper providing an overview of RT models.</li>
<li><a href="https://github.com/vasishth/bayescogsci">https://github.com/vasishth/bayescogsci</a></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-balota2011moving" class="csl-entry" role="listitem">
Balota, David A, and Melvin J Yap. 2011. <span>“Moving Beyond the Mean in Studies of Mental Chronometry: The Power of Response Time Distributional Analyses.”</span> <em>Current Directions in Psychological Science</em> 20 (3): 160–66.
</div>
<div id="ref-heathcote2012linear" class="csl-entry" role="listitem">
Heathcote, Andrew, and Jonathon Love. 2012. <span>“Linear Deterministic Accumulator Models of Simple Choice.”</span> <em>Frontiers in Psychology</em> 3: 292.
</div>
<div id="ref-hohle1965inferred" class="csl-entry" role="listitem">
Hohle, Raymond H. 1965. <span>“Inferred Components of Reaction Times as Functions of Foreperiod Duration.”</span> <em>Journal of Experimental Psychology</em> 69 (4): 382.
</div>
<div id="ref-kieffaber2006switch" class="csl-entry" role="listitem">
Kieffaber, Paul D, Emily S Kappenman, Misty Bodkins, Anantha Shekhar, Brian F O’Donnell, and William P Hetrick. 2006. <span>“Switch and Maintenance of Task Set in Schizophrenia.”</span> <em>Schizophrenia Research</em> 84 (2-3): 345–58.
</div>
<div id="ref-lo2015transform" class="csl-entry" role="listitem">
Lo, Steson, and Sally Andrews. 2015. <span>“To Transform or Not to Transform: Using Generalized Linear Mixed Models to Analyse Reaction Time Data.”</span> <em>Frontiers in Psychology</em> 6: 1171.
</div>
<div id="ref-matzke2009psychological" class="csl-entry" role="listitem">
Matzke, Dora, and Eric-Jan Wagenmakers. 2009. <span>“Psychological Interpretation of the Ex-Gaussian and Shifted Wald Parameters: A Diffusion Model Analysis.”</span> <em>Psychonomic Bulletin &amp; Review</em> 16: 798–817.
</div>
<div id="ref-schramm2019reaction" class="csl-entry" role="listitem">
Schramm, Pele, and Jeffrey N Rouder. 2019. <span>“Are Reaction Time Transformations Really Beneficial?”</span>
</div>
<div id="ref-theriault2024check" class="csl-entry" role="listitem">
Thériault, Rémi, Mattan S Ben-Shachar, Indrajeet Patil, Daniel Lüdecke, Brenton M Wiernik, and Dominique Makowski. 2024. <span>“Check Your Outliers! An Introduction to Identifying Statistical Outliers in r with Easystats.”</span> <em>Behavior Research Methods</em> 56 (4): 4162–72.
</div>
<div id="ref-wagenmakers2008diffusion" class="csl-entry" role="listitem">
Wagenmakers, Eric-Jan, Roger Ratcliff, Pablo Gomez, and Gail McKoon. 2008. <span>“A Diffusion Model Account of Criterion Shifts in the Lexical Decision Task.”</span> <em>Journal of Memory and Language</em> 58 (1): 140–59.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./3_scales.html" class="pagination-link" aria-label="Choice and Scales">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Choice and Scales</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./5_individual.html" class="pagination-link" aria-label="Individual Parameters">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Individual Parameters</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>